[build]
  base = "web"
  # Run migrations in CI/CD only when DATABASE_URL is provided (production).
  # This ensures the Order table exists so paid checkouts can be persisted.
  command = "npx prisma generate && (test -n \"$DATABASE_URL\" && npx prisma migrate deploy || echo \"Skipping prisma migrate deploy (no DATABASE_URL)\") && npm run build"
  publish = ".next"

[build.environment]
  NODE_VERSION = "20"
  SECRETS_SCAN_OMIT_PATHS = "README.md,web/server.log,web/*.log"
  SECRETS_SCAN_OMIT_KEYS = "NEXT_PUBLIC_SITE_URL"

[[plugins]]
  package = "@netlify/plugin-nextjs"
